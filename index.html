<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ESV Lookup</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: #111; color: #e0e0e0;
    min-height: 100dvh; padding: 16px;
    display: flex; flex-direction: column;
  }
  h1 { font-size: 18px; font-weight: 600; margin-bottom: 12px; color: #fff; }
  .search-row { display: flex; gap: 8px; margin-bottom: 6px; }
  input {
    flex: 1; padding: 12px 14px; font-size: 16px;
    background: #1a1a1a; border: 1px solid #333; border-radius: 8px;
    color: #fff; outline: none;
  }
  input:focus { border-color: #555; }
  input::placeholder { color: #555; }
  button.search-btn {
    padding: 12px 20px; font-size: 16px; font-weight: 600;
    background: #2563eb; color: #fff; border: none; border-radius: 8px;
    cursor: pointer; white-space: nowrap;
  }
  button.search-btn:active { background: #1d4ed8; }
  .hint { font-size: 12px; color: #444; margin-bottom: 16px; }
  .results { flex: 1; display: flex; flex-direction: column; gap: 10px; }
  .verse-block {
    background: #1a1a1a; border: 1px solid #282828; border-radius: 10px;
    padding: 14px; position: relative;
  }
  .verse-ref {
    font-size: 13px; font-weight: 600; color: #60a5fa;
    margin-bottom: 6px; letter-spacing: 0.3px;
  }
  .verse-text {
    font-size: 15px; line-height: 1.6; color: #d4d4d4;
    user-select: text; -webkit-user-select: text;
    white-space: pre-wrap;
  }
  .verse-text mark {
    background: rgba(37, 99, 235, 0.25); color: #93bbfc;
    border-radius: 2px; padding: 0 1px;
  }
  .btn-row { display: flex; gap: 6px; margin-top: 10px; flex-wrap: wrap; }
  .pill {
    background: #282828; border: 1px solid #333; border-radius: 6px;
    color: #999; font-size: 11px; padding: 5px 9px; cursor: pointer;
  }
  .pill:active { background: #333; }
  .pill.copied { color: #34d399; }
  .pill.active { color: #60a5fa; }
  .context-block {
    margin-top: 10px; padding-top: 10px; border-top: 1px solid #282828; display: none;
  }
  .context-block.open { display: block; }
  .context-ref { font-size: 12px; font-weight: 600; color: #555; margin-bottom: 6px; }
  .context-text {
    font-size: 14px; line-height: 1.6; color: #888;
    user-select: text; -webkit-user-select: text; white-space: pre-wrap;
  }
  .result-count { font-size: 12px; color: #555; margin-bottom: 8px; }
  .load-more {
    padding: 12px; font-size: 14px; font-weight: 500;
    background: #1a1a1a; border: 1px solid #333; border-radius: 8px;
    color: #60a5fa; cursor: pointer; text-align: center; width: 100%;
  }
  .load-more:active { background: #222; }
  .error { color: #f87171; font-size: 14px; padding: 12px; }
  .loading { color: #666; font-size: 14px; padding: 12px; }
  .copyright {
    font-size: 10px; color: #444; margin-top: 16px; padding-top: 12px;
    border-top: 1px solid #222; line-height: 1.4;
  }
  @media (max-width: 480px) {
    body { padding: 12px; }
    .search-row { flex-direction: column; }
    button.search-btn { padding: 14px; }
  }
</style>
</head>
<body>
<h1>ESV Lookup</h1>
<div class="search-row">
  <input type="text" id="ref" placeholder="John 3:16, Romans 8:28-39, or love one another" autofocus>
  <button class="search-btn" onclick="go()">Go</button>
</div>
<div class="hint">Reference (John 3:16) returns verse text. Words (love one another) searches the Bible.</div>
<div class="result-count" id="count" style="display:none"></div>
<div class="results" id="results"></div>
<div class="copyright" id="copyright" style="display:none">
  Scripture quotations are from the ESV\u00AE Bible, \u00A9 2001 by Crossway. Used by permission.
</div>
<script>
var API_KEY='1b642e9cd66a126fb60c68853d6ae23b64ad2532';
var PASSAGE_URL='https://api.esv.org/v3/passage/text/';
var SEARCH_URL='https://api.esv.org/v3/passage/search/';
var searchPage=1,searchQuery='',totalResults=0,totalPages=0;
var input=document.getElementById('ref'),results=document.getElementById('results'),copyright=document.getElementById('copyright'),count=document.getElementById('count');
input.addEventListener('keydown',function(e){if(e.key==='Enter')go()});
function isReference(q){return /^[1-3]?\s*[A-Za-z]+\.?\s+\d+/i.test(q.trim())}
function go(){var q=input.value.trim();if(!q)return;if(isReference(q)){lookup(q)}else{search(q)}}
function escAttr(s){return s.replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;')}
function getChapterRef(ref){var m=ref.match(/^(.+?)\s+(\d+)/);return m?m[1]+' '+m[2]:ref}
async function lookup(q){results.innerHTML='<div class="loading">Loading...</div>';count.style.display='none';try{var params=new URLSearchParams({q:q,'include-headings':false,'include-footnotes':false,'include-verse-numbers':true,'include-short-copyright':false,'include-passage-references':true,'indent-paragraphs':0,'indent-poetry':false,'line-length':0});var res=await fetch(PASSAGE_URL+'?'+params,{headers:{'Authorization':'Token '+API_KEY}});if(!res.ok)throw new Error('API error');var data=await res.json();if(!data.passages||data.passages.length===0||!data.passages[0].trim()){results.innerHTML='<div class="error">No results. Check your reference.</div>';return}results.innerHTML='';copyright.style.display='block';data.passages.forEach(function(text){var cleanText=text.trim();var ref=data.canonical;var chapterRef=getChapterRef(ref);var block=document.createElement('div');block.className='verse-block';var id='ctx-'+Math.random().toString(36).substr(2,6);block.innerHTML='<div class="verse-ref">'+ref+'</div><div class="verse-text">'+cleanText+'</div><div class="btn-row"><button class="pill" onclick="copyText(this)" data-text="'+escAttr(ref+'\n'+cleanText)+'">Copy</button><button class="pill" onclick="loadContext(this,\''+escAttr(chapterRef)+'\',\''+id+'\')">Full chapter</button></div><div class="context-block" id="'+id+'"><div class="context-ref"></div><div class="context-text"></div><div class="btn-row"><button class="pill" style="display:none" onclick="copyCtx(this,\''+id+'\')">Copy chapter</button></div></div>';results.appendChild(block)})}catch(err){results.innerHTML='<div class="error">Failed to fetch. Check your reference.</div>'}}
async function search(q,append){if(!append){searchPage=1;searchQuery=q;results.innerHTML='<div class="loading">Searching...</div>'}try{var params=new URLSearchParams({q:searchQuery,'page-size':20,page:searchPage});var res=await fetch(SEARCH_URL+'?'+params,{headers:{'Authorization':'Token '+API_KEY}});if(!res.ok)throw new Error('API error');var data=await res.json();totalResults=data.total_results;totalPages=data.total_pages;if(!data.results||data.results.length===0){if(!append){results.innerHTML='<div class="error">No verses found.</div>';count.style.display='none'}return}if(!append)results.innerHTML='';copyright.style.display='block';count.style.display='block';count.textContent=totalResults+' verse'+(totalResults!==1?'s':'')+' found';var words=searchQuery.toLowerCase().split(/\s+/);data.results.forEach(function(r){var highlighted=r.content;words.forEach(function(w){if(w.length>2){var re=new RegExp('('+w.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')+')','gi');highlighted=highlighted.replace(re,'<mark>$1</mark>')}});var chapterRef=getChapterRef(r.reference);var id='ctx-'+Math.random().toString(36).substr(2,6);var block=document.createElement('div');block.className='verse-block';block.innerHTML='<div class="verse-ref">'+r.reference+'</div><div class="verse-text">'+highlighted+'</div><div class="btn-row"><button class="pill" onclick="copyText(this)" data-text="'+escAttr(r.reference+'\n'+r.content)+'">Copy</button><button class="pill" onclick="jumpLookup(\''+escAttr(r.reference)+'\')">Look up</button><button class="pill" onclick="loadContext(this,\''+escAttr(chapterRef)+'\',\''+id+'\')">Full chapter</button></div><div class="context-block" id="'+id+'"><div class="context-ref"></div><div class="context-text"></div><div class="btn-row"><button class="pill" style="display:none" onclick="copyCtx(this,\''+id+'\')">Copy chapter</button></div></div>';results.appendChild(block)});var oldBtn=document.querySelector('.load-more');if(oldBtn)oldBtn.remove();if(searchPage<totalPages){var btn=document.createElement('button');btn.className='load-more';btn.textContent='Load more (page '+(searchPage+1)+' of '+totalPages+')';btn.onclick=function(){searchPage++;search(searchQuery,true)};results.appendChild(btn)}}catch(err){if(!append)results.innerHTML='<div class="error">Search failed. Try again.</div>'}}
async function loadContext(btn,chapterRef,id){var container=document.getElementById(id);if(container.classList.contains('open')){container.classList.remove('open');btn.classList.remove('active');btn.textContent='Full chapter';return}btn.textContent='Loading...';try{var params=new URLSearchParams({q:chapterRef,'include-headings':true,'include-footnotes':false,'include-verse-numbers':true,'include-short-copyright':false,'include-passage-references':true,'indent-paragraphs':0,'indent-poetry':false,'line-length':0});var res=await fetch(PASSAGE_URL+'?'+params,{headers:{'Authorization':'Token '+API_KEY}});if(!res.ok)throw new Error('API error');var data=await res.json();if(data.passages&&data.passages[0]){container.querySelector('.context-ref').textContent=data.canonical;container.querySelector('.context-text').textContent=data.passages[0].trim();var copyBtn=container.querySelector('.pill');copyBtn.style.display='';copyBtn.dataset.text=data.canonical+'\n'+data.passages[0].trim();container.classList.add('open');btn.textContent='Hide chapter';btn.classList.add('active')}}catch(err){btn.textContent='Failed';setTimeout(function(){btn.textContent='Full chapter'},1500)}}
function jumpLookup(ref){input.value=ref;lookup(ref);window.scrollTo(0,0)}
function copyText(btn){doCopy(btn.dataset.text,btn)}
function copyCtx(btn,id){var c=document.getElementById(id);doCopy(c.querySelector('.context-ref').textContent+'\n'+c.querySelector('.context-text').textContent,btn)}
function doCopy(text,btn){navigator.clipboard.writeText(text).then(function(){btn.textContent='Copied!';btn.classList.add('copied');setTimeout(function(){btn.textContent='Copy';btn.classList.remove('copied')},1500)}).catch(function(){var ta=document.createElement('textarea');ta.value=text;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);btn.textContent='Copied!';btn.classList.add('copied');setTimeout(function(){btn.textContent='Copy';btn.classList.remove('copied')},1500)})}
</script>
</body>
</html>
